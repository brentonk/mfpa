---
echo: false
---

# Sequences and Series {#sec-sequences-series}

```{r setup_r, echo=FALSE, message=FALSE}
library("tidyverse")
library("cowplot")
theme_set(theme_cowplot())
```

```{python setup, echo=FALSE}
# Set up concept dictionary
concepts = {}
```

## Motivating example: Incumbent advantage {#sec-sequences-motivation}

I'm going to propose an extremely (overly!) simple model of incumbent party advantage in legislative elections, ask a very simple question of the model, and show that it leads us into having to do an addition of infinitely many terms.

Here's the model.
There is a legislative seat that is contested every election cycle.
In each election, the incumbent party wins with probability $p$ and loses with probability $1 - p$, where $0 < p < 1$.
These elections are independent in the statistical sense, in that the probability of winning is $p$ in each cycle, regardless of what has happened before.
The question is: given $p$, how many more terms would we expect the incumbent party to hold the seat, on average?

Our goal here is to calculate the expected value,
\begin{align}
\MoveEqLeft{}
\sum_{T = 0}^\infty T \cdot \Pr(\text{term length} = T) \\
&= 0 \cdot \Pr(\text{term length} = 0)
+ 1 \cdot \Pr(\text{term length} = 1) \\
&\quad + 2 \cdot \Pr(\text{term length} = 2)
+ 3 \cdot \Pr(\text{term length} = 3) + \cdots
\end{align}

::: {.callout-note title="Summation notation"}
Don't remember what $\sum$ means?
Don't panic!
It's the [summation]{.concept} symbol, which we use when we're adding many things together.
For example, think about summing up the square of every number from 1 to 39.
We could write that as $$1^2 + 2^2 + \cdots + 38^2 + 39^2.$$
A shorter way to write that, with the added advantage of leaving absolutely no ambiguity about precisely what we're summing up, would be with the summation symbol: $$\sum_{n=1}^{39} n^2.$$
More generally, the notation $\sum_{n=k}^K x_n$ stands for the sum $x_k + x_{k+1} + \cdots + x_{K - 1} + x_K$.
The notation $\sum_{n=k}^\infty x_n$ stands for a sum of infinitely many terms, $x_k + x_{k+1} + x_{k+2} + \cdots$ and so on indefinitely.
:::

```{python, echo=FALSE}
concepts.update(
    {
        "Summation": "A concise way to denote adding up many terms.  The notation $\\sum_{i=1}^n x_i$ is shorthand for $x_1 + x_2 + \\cdots + x_n$."
    }
)
```

Given any term length $T$, there's a nonzero, though probably quite small, probability that the incumbent party will stay in office at least $T$ terms.
This means we'll need to add together infinitely many numbers to calculate the expected term length.
How can we even do that?
Won't we just end up with infinity at the end?

Let's get more specific about what we need to calculate here.

- The probability that the incumbent party has 0 more terms is the probability of losing the election immediately, namely $1 - p$.

- The probability of exactly one more term is the probability of winning the election this term and then losing the next one, namely $p \times (1 - p)$.

- The probability of exactly two more terms is the probability of winning this election and the next one, then losing the one after that, namely $p \times p \times (1 - p)$.

- The probability of exactly three more terms is the probability of winning the next three elections but losing the one after that, namely $p \times p \times p \times (1 - p)$.

You might be starting to notice that there's a certain structure here.
The probability that the incumbent party lasts $T$ more terms in office is $$\underbrace{p \times p \times \cdots \times p}_{\text{$T$ times}} \times (1 - p) = p^T (1 - p).$$
This means the expected value we are trying to calculate is
$$
\sum_{T = 0}^\infty T \cdot \Pr(\text{term length} = T)
= \sum_{T = 0}^\infty T p^T (1 - p).
$$

::: {.aside}
You may be wondering why this formula applies to the $T = 0$ case too.
It applies because $p^0 = 1$ for any nonzero number $p$.
Therefore, when $T = 0$, we have $p^T (1 - p) = 1 - p$, the probability that the incumbent party loses office immediately.
:::

```{r, echo=FALSE}
# Fix value of p and max term length to examine
p <- 0.75
term_max <- 40
```

Let's head to the computer to look at the components of this sum.
Sadly we can't look at all of the infinitely many components, so let's just go up to $T = `r term_max`$.
We will look at the case where $p = `r p`$.
First, for each length up to `r term_max` terms, let's look at the probability that the terms lasts that long.

::: {.aside}
If you want to see the R code that generates these figures, go to the Quarto source code for these lecture notes [on GitHub](https://github.com/brentonk/mfpa).
:::

```{r, echo=FALSE}
# Calculate the probability that the term lasts this long
term_length <- 0:term_max
prob <- p^term_length * (1 - p)

# Calculate the individual components of the expected value sum
ev_component <- term_length * prob

# Calculate the cumulative sum through each term length
cumsum_ev <- cumsum(ev_component)

# Put the relevant items together in a data frame ("tibble")
df_incumbency <- tibble(term_length, prob, ev_component, cumsum_ev)

# Plot each term length probability
df_incumbency |>
  ggplot(aes(x = term_length, y = prob)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray75") +
  geom_line() +
  geom_point() +
  labs(
    title = str_glue("Probability of each term length up to {term_max}"),
    x = "Term length",
    y = "Probability"
  )
```

According to this model, if $p = 0.75$, then the probability that the incumbent party stays in power for 20 or more consecutive terms is negligible.
But this is only part of the expected value calculation.
To calculate the expected value, we multiply the probability of each possible term length by the term length itself.
So let's multiply the probabilities from the last figure by the corresponding term length to see the individual components in the expected value calculation.

```{r, echo=FALSE}
df_incumbency |>
  ggplot(aes(x = term_length, y = ev_component)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray75") +
  geom_line() +
  geom_point() +
  labs(
    title = "Components of the expected value of term length",
    x = "Term length",
    y = "Term length times probability"
  )
```

Term lengths of 3 or 4 end up with the highest weights in the expected value calculation, once we weight the probability of each term length by the number of terms it represents.
Perhaps more importantly for our purposes, even after we multiply the probabilities by term length, we see that the values get very close to 0 around $T = 30$ or so.
If this weren't the case --- i.e., if there were some nonzero floor on the expected value components --- then the sum we're trying to calculate, $\sum_{T=0}^\infty T p^T (1 - p)$, would necessarily be infinite.

Finally, let's see what we get when we add up the expected value components up to each $T$.
These finite calculations can't tell us what the *infinite* sum would equal, but we'll see that they give us a pretty good idea.

```{r}
df_incumbency |>
  ggplot(aes(x = term_length, y = cumsum_ev)) +
  geom_hline(yintercept = 3, linetype = "dashed", color = "gray75") +
  geom_line() +
  geom_point() +
  labs(
    title = "Sum of e.v. components up to given term length",
    x = "Term length",
    y = "Cumulative sum"
  )
```

It sure looks like our infinite sum tops out at 3.
At this point, if I had to guess, I'd guess that the expected term length is 3 when $p = 0.75$.
How can we say that with certainty instead of just guessing based on the eyeball test?
Is there a formula that will let us calculate the expected term length for any value of the term-by-term retention probability $p$?
By the end of this chapter, we'll have a mathematical foundation to answer these questions.


## Sequences and Limits {#sec-sequences-limits}

A [sequence]{.concept} is an infinite, ordered list of numbers.
We write $\{x_n\}$ to denote the sequence $x_1, x_2, x_3, \ldots$, with $x_n$ standing for the $n$'th entry in the sequence.
Unlike with sets, order and repetition matter in a sequence.
For example, the sequence $0, 1, 0, 1, \ldots$ is distinct from the sequence $1, 0, 1, 0, \ldots$ and the sequence $0, 0, 1, 1, 0, 0, 1, 1, \ldots$.

```{python, echo=FALSE}
concepts.update(
    {
        "Sequence": "An infinite, ordered list of numbers typically denoted $\\{x_n\\}$.",
    }
)
```

::: {.callout-warning title="Sequences vs. sets"}
Because we use curly brackets to denote both sequences and sets, there are some cases where it can be confusing to distinguish a single-element set from a sequence.
The main context clue to look for is the presence of an index subscript: for example, $\{3\}$ isn't a sequence because there's no index variable.
By the same token, it would be cruel and unusual for a mathematical writer to use $\{x_n\}$ to mean "the set whose sole element is $x_n$" rather than "the sequence $x_1, x_2, \ldots$."
If you ever want to send a very strong signal that something is a sequence, you may use a subscript to explicitly call out the index, using the notation $\{x_n\}_{n=1}^\infty$.
Or, you know, you can just say "the sequence $\{x_n\}$."
Words are helpful!
:::

A sequence is ordered, in that it is sensible to talk about the first or tenth or 1,052,402nd element of a sequence.
Additionally, any sequence we'll talk about in this course will consist of elements that are all real numbers.
Putting these two facts together, you can also think of a sequence as a function that maps the set of natural numbers, $\mathbb{N}$, into the set of real numbers, $\mathbb{R}$.

### Definition of a limit {#sec-def-limit}

Think about the sequence $1, \frac{1}{2}, \frac{1}{3}, \frac{1}{4}, \ldots$.
To denote this formally, let $\{x_n\}$ be the sequence where each $x_n = \frac{1}{n}$.
The further we go along this sequence, the closer the values get to 0 --- though we never quite get all the way there.
Indeed, we would say the [limit]{.concept} of the sequence is 0, which we'd denote by writing $\lim_{n \to \infty} x_n = 0$ or, more simply, $\{x_n\} \to 0$.

```{r} 
tibble(n = 1:40, x_n = 1/n) |>
  ggplot(aes(x = n, y = x_n)) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray75") +
  labs(
    title = "{1/n} → 0 as n → ∞",
    x = "Index: n",
    y = "Sequence value: 1/n"
  )
```

```{python}
concepts.update({
  "Limit": "A point that a sequence $\\{x_n\\}$ approaches as $n$ grows larger and larger.  To denote $\\ell$ being the limit of $\\{x_n\\}$, we may write $\\lim_{n \\to \infty} x_n = \\ell$ or $\\{x_n\\} \\to \\ell$.  Some sequences have no limit.  See @def-limit for a fully rigorous mathematical definition of a limit.",
  "Convergent sequence": "A sequence that has a finite limit.",
  "Divergent sequence": "A sequence that has no finite limit, either because it has an infinite limit or because it oscillates.",
})
```

What we need now is a precise mathematical notion of "getting closer and closer."
The infinite nature of a sequence makes this tricky.
We can't follow the sequence and see that it ends at 0, because the sequence has no end!
To get around this issue, mathematicians use what I think of as a "challenge-response" definition of a limit.
Here's what I mean by that.
Suppose I have a sequence $\{x_n\}$ and claim that its limit is a number $\ell$.

1. You **challenge** me by picking a number $\epsilon > 0$.
   Think of this as you saying "I need you to show me that once we get far enough along the sequence, every value is within $\epsilon$ of your supposed limit."

2. I **respond** to the challenge by identifying an index $N$ after which the sequence values are as close as you demand.
   In particular, I need to show you that $\ell - \epsilon < x_n < \ell + \epsilon$ for all indices $n \geq N$.

My claimed limit is true if and only if I can conjure up a valid response to any $\epsilon > 0$ that you might pick.
The formal definition of a limit puts this process in precise mathematical terms.

::: {#def-limit name="Finite limit"}
The sequence $\{x_n\}$ has a [limit]{.concept} of $\ell \in \mathbb{R}$ if the following condition is satisfied: for any real number $\epsilon > 0$, we can identify an index $N$ such that $|x_n - \ell| < \epsilon$ for all $n \geq N$.
The sequence is [convergent]{.concept} if and only if $\lim_{n \to \infty} x_n = \ell$ for some finite number $\ell$.
:::

To make the challenge-response process a bit more concrete, let's apply it to the problem of showing that $\lim_{n \to \infty} 1/n = 0$.

::: {#exm-limit-harmonic-seq}
We want to prove that $\lim_{n \to \infty} 1/n = 0$.
To do so, we must show that for any choice of a number $\epsilon > 0$, we can find an index $N$ such that $-\epsilon < 1/n < \epsilon$ for all $n \geq N$.

You can think about this as a "for all" claim: namely, that for all $\epsilon > 0$, there is an index $N$ that meets the requirement above.
So to prove it, we will follow the method laid out in @nte-proving-for-all in the previous chapter.
That is, we will take an "arbitrary" $\epsilon > 0$ --- a number $\epsilon$ that we know nothing about, besides that it's greater than 0 --- and prove that we can find an index $N$ that meets the requirement.

*Proof:*
Take an arbitrary $\epsilon > 0$.
Because $\epsilon > 0$, the fraction $1/\epsilon$ is finite, though perhaps very large.
Let $N$ be any integer greater than $1/\epsilon$.
For any $n \geq N$, we have $$\frac{1}{n} \leq \frac{1}{N} < \frac{1}{1/\epsilon} = \epsilon.$$
Combined with the fact that $1/n > 0 > -\epsilon$ for all $n$, we have shown that there exists an index $N$ such that $-\epsilon < 1/n < \epsilon$ for all $n \geq N$.
Because $\epsilon$ was chosen arbitrarily, this completes the proof that $\lim_{n \to \infty} 1/n = 0$.
:::

::: {.aside}
It would be reasonable to be skeptical about the (critical!) step in @exm-limit-harmonic-seq where I assert the existence of an integer greater than $1/\epsilon$.
If you are indeed skeptical in this way, don't worry --- the [Archimedean property](https://en.wikipedia.org/wiki/Archimedean_property) of the real numbers guarantees it.
(And if you weren't skeptical, perhaps you should have been?)
:::

Not every sequence is convergent.
We call a sequence [divergent]{.concept} if it is not convergent.
One reason that a sequence might be divergent is that the values in the sequence increase (or decrease) without bound.
For example, the sequence $1, 2, 3, \ldots$ is divergent, as are the sequences $-1, -2, -3, \ldots$ and $1, -1, 2, -2, 3, -3, \ldots$.
In fact, it turns out that a necessary condition for a sequence to converge is that the sequence be [bounded]{.concept}.

::: {#def-bounded-sequence name="Bounded sequence"}
We say the sequence $\{x_n\}$ is [bounded]{.concept} if there is a finite number $B$ such that $-B \leq x_n \leq B$ for all indices $n$.
:::

```{python} 
concepts.update({
  "Bounded sequence": "A sequence for which there is a finite number $B$ such that every $|x_n| \\leq B$.  Every convergent sequence is bounded, but not every bounded sequence is convergent.",
})
```

::: {#prp-convergent-implies-bounded name="Convergent implies bounded"}
If $\{x_n\}$ is convergent, then it is bounded.
:::

We're going to prove @prp-convergent-implies-bounded, but first we need to establish that a convergent sequence has exactly one limit.
In other words, there can't be two different numbers $\ell$ and $\ell'$ such that $\{x_n\} \to \ell$ and $\{x_n\} \to \ell'$.
Perhaps the uniqueness of the limit seems obvious, but it's something that we can and should explicitly prove.
FYI, we kind of already implicitly assumed this property when we used the notation $\lim_{n \to \infty} x_n = \ell$.

::: {#lem-limit-unique name="Uniqueness of limit"}
A convergent sequence has exactly one limit: if $\{x_n\} \to \ell$ and $\{x_n\} \to \ell'$, then $\ell = \ell'$.
:::

::: {.proof}
Before getting into the technicalities, here's the basic logic behind the proof.
We're going to take a convergent sequence with a limit $\ell$.
We then want to show that any other number $\ell' \neq \ell$ cannot be a limit of the sequence.
To do that, we'll show that the requirement of getting closer and closer to $\ell$ is incompatible with getting closer and closer to $\ell'$.
In particular, if the sequence meets *every* challenge to the claim that $\ell$ is the limit, then we can find *some* challenge to knock down the claim of $\ell'$ as a limit.

Let $\{x_n\}$ be a convergent sequence with limit $\ell$.
Consider any number $\ell' > \ell$.
To show that $\ell'$ is not a limit of $\{x_n\}$, we will construct a "challenge" to the claim of $\ell'$ as a limit for which there is no valid response.
Specifically, we must identify a value $\epsilon > 0$ such that for every index $n$, there is *some* index $m \geq n$ for which $|x_m - \ell'| \geq \epsilon$.

I claim that $\epsilon = (\ell' - \ell) / 2$ (i.e., half the distance between the limit and the alternative we're trying to rule out) constitutes a challenge of the form that we need.
Because $\{x_n\} \to \ell$, there is an index $N$ such that $$\ell - \epsilon < x_n < \ell + \epsilon$$ for all indices $n \geq N$.
Now we want to show that for any index $n$, we can find an index $m \geq n$ such that $x_m < \ell' - \epsilon$ or $x_m > \ell' - \epsilon$.
To this end, take any index $n$, and let $m$ be whichever is greater: the $N$ we identified for the $\epsilon$ challenge to $\ell$ as the limit, or $n$ itself.
Because $m \geq N$, we have
\begin{align}
x_n &< \ell + \epsilon \\
&= \ell + \frac{\ell' - \ell}{2} \\
&= \ell' - \frac{\ell' - \ell}{2} \\
&= \ell' - \epsilon.
\end{align}
We have shown that there is no valid response to the $\epsilon$ challenge to $\ell'$ as a limit of $\{x_n\}$.
Therefore, $x_n \nrightarrow \ell'$.

We have now ruled out any $\ell' > \ell$ as a limit of $\{x_n\}$.
The steps to rule out any $\ell' < \ell$ are very similar: we consider the challenge with $\epsilon = (\ell - \ell') / 2$ and show that for any $n$ there is an $m \geq n$ for which $x_n > \ell' + \epsilon$, proving that $\{x_n\} \nrightarrow \ell'$.
You can make these replacements in the previous paragraph yourself to rule out $\ell' < \ell$ as a limit of $\{x_n\}$.
We conclude that no $\ell' \neq \ell$ may be a limit of $\{x_n\}$.
(A math textbook or academic paper might say, "The proof for the $\ell' < \ell$ case is analogous" as shorthand for the paragraph I've just written here.)
:::

::: {.proof}
Suppose the sequence $\{x_n\}$ is convergent, and let $\ell$ denote its limit.
***FINISH ME***
:::

An equivalent statement would be the contrapositive, "If $\{x_n\}$ is not bounded, then it is not convergent."
That's a useful fact in practice.
If you observe that a sequence is unbounded, you can stop looking for a finite limit --- it can't have one.

@prp-convergent-implies-bounded is an "if" statement, not an "if and only if."
Just as every zebra is a mammal but not every mammal is a zebra, every convergent sequence is bounded but not every bounded sequence is convergent.
The next exercise asks you to think of an example.

::: {#exr-bounded-does-not-imply-convergent name="Bounded does not imply convergent"}
Come up with an example of a bounded sequence that is not convergent.

:::: {.callout-note title="Answer" collapse="true"}
There are many examples of convergent sequences that are not bounded, but the simplest one I can think of is $0, 1, 0, 1, \ldots$, i.e., the sequence $\{x_n\}$ where each
$$
x_n = \begin{cases}
0 & \text{if $n$ is odd}, \\
1 & \text{if $n$ is even}.
\end{cases}
$$
To prove that $\{x_n\}$ is not convergent, I will just rule out every number as a potential limit for it.

- No $\ell \neq 0$ may be the limit of $\{x_n\}$.
  To see why, take any $\ell \neq 0$.
  To show that $\ell$ is not the limit, we need to find a "challenge" value $\epsilon$ for which there is no valid response.

  I claim that $\epsilon = |\ell|$ is this type of unmeetable challenge.
  To show that the challenge cannot be met, we need to show that at any point in the sequence, we can find a value there or further along that is at least $\epsilon$ away from $\ell$.
  To do this, take any index $n$.
  Then either $x_n = 0$ or $x_{n+1} = 0$, meaning that either $|x_n - \ell| \geq \epsilon$ or $|x_{n+1} - \ell| \geq \epsilon$.
  Therefore, $\ell$ cannot be a limit of the sequence.

- No $\ell \neq 1$ may be the limit of $\{x_n\}$ either.
  The logic here is the same as in the previous step --- just take any $\ell \neq 1$ and show that the challenge with $\epsilon = |\ell - 1|$ cannot succeed.

- The first step leaves $\ell = 0$ as the only possible limit, but the second step rules that out too.
  Therefore, $\{x_n\}$ has no limit.
::::
:::

***BOUNDED AND MONOTONE IMPLIES CONVERGENT.***

::: {#def-limit-infinite name="Infinite limit"}
For a sequence $\{x_n\}$, we say that $\{x_n\} \to \infty$ if the following condition is satisfied: for any real number $y$, we can identify an index $N$ such that $x_n > y$ for all $n \geq N$.
Similarly, we say that $\{x_n\} \to -\infty$ if for any real number $y$, we can identify an index $N$ such that $x_n < y$ for all $n \geq N$.
:::

### Properties of limits {#sec-properties-of-limits}

Don't worry if the formal definition of a limit (@def-limit) seems daunting and cumbersome to use.
In practice, most of the time that you end up dealing with limits, you won't have to explicitly deal with the challenge-response structure.
Instead, you can use helpful properties of limits to work up from limits you already know.
For example, given that $\{1/n\} \to 0$ (as we showed above in @exm-limit-harmonic-seq), it seems intuitive that $\{1/n^2\} \to 0$ as well.
Can we prove this without explicitly invoking the challenge-response logic?

***SEQUENCE HAS AT MOST ONE LIMIT***

***SUMS, PRODUCTS, CONSTANT MULTIPLES, RATIOS OF LIMITS.***

***CONVERGENT SEQUENCE IS BOUNDED***

***SEQUENCE MAY NOT HAVE A LIMIT***


```{python, echo=FALSE, results="asis"}
from helpers import concept_table

print(concept_table(concepts))
```

